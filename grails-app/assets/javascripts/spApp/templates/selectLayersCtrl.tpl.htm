
<select ng-model='mode' ng-change='changeSelectedItem(mode)'>
    <option value="">Search layers</option>
    <option value="pasteLayers">Paste a layer set</option>
    <option value="uploadLayers">Upload a layer set</option>
    <option ng-repeat='x in predefinedLists' value='{{x.value}}'>{{x.label}}</option>
</select>
<hr/>

<div style="min-height:460px">
    <div ng-show="mode == 'uploadLayers'">
        <br/>
        <input type="file" id="file" name="file"/>
        <br/>
        <div class="btn-group btn-group-sm">
            <button class="btn btn-default" ng-click="mode = ''">&lt; Back</button>
            <button class="btn btn-default" ng-click="upload()">Upload</button>
        </div>
    </div>

    <div ng-show="mode == 'pasteLayers'">
        <textarea ng-model="pasteLayersTxt" style="height:200px;width:90%" name="pasteLayers"></textarea>
        <br/>
        <div class="btn-group btn-group-sm">
            <button class="btn btn-default" ng-click="mode = ''">&lt; Back</button>
            <button class="btn btn-default" ng-click="addList(pasteLayersTxt);mode = ''">Add</button>
        </div>
    </div>

    <div ng-show="mode == ''">

        <div class="container" style="width:680px">
            <div style="margin-left: -15px;">
                <div ng-hide="layers == undefined || layers.length == 0">
                    <label style="width:120px">Search</label><input style="width:300px" layer-auto-complete environmental="true" contextual="true" on-custom="add">

                    <br/>
                    <label style="width:120px;">Filter</label><input type="text" width="150px" placeholder="Filter layers" ng-model="searchLayer">
                    <label style="padding-left:20px;" ng-show="searchLayer.length > 0">{{(layers | filter:searchLayer).length}} matching layers</label>

                    <table class="table table-striped fixed-head layers-table" >
                        <thead>
                        <tr>
                            <th style="width:20px"></th>
                            <th style="width:20px"></th>
                            <th style="width:300px">
                                <div href="#" ng-click="sortType = 'classification'; sortReverse = !sortReverse">
                                    Classification
                                    <span ng-show="sortType == 'classification' && !sortReverse" class="glyphicon glyphicon-chevron-down"></span>
                                    <span ng-show="sortType == 'classification' && sortReverse" class="glyphicon glyphicon-chevron-up"></span>
                                </div></th>
                            <th style="width:300px">
                                <div href="#" ng-click="sortType = 'name'; sortReverse = !sortReverse">
                                    Name
                                    <span ng-show="sortType == 'name' && !sortReverse" class="glyphicon glyphicon-chevron-down"></span>
                                    <span ng-show="sortType == 'name' && sortReverse" class="glyphicon glyphicon-chevron-up"></span>
                                </div></th>
                            <th style="width:10px"></th>
                            <th style="width:10px"></th>
                        </tr>
                        </thead>
                        <tbody style="height:300px;overflow:scroll">
                        <tr ng-repeat="layer in layers | orderBy:sortType:sortReverse | filter:searchLayer">
                            <td style="width:20px"><input type="checkbox" ng-model="layer.selected" ng-click="toggle(layer)">
                            </td>
                            <td style="width:20px"><img
                                    ng-src="assets/icon_{{layer.type == 'e' ? 'grid':'contextual'}}-layer.png"></td>
                            <td style="width:300px">{{ layer.classification}}</td>
                            <td style="width:300px">{{ layer.name }}</td>
                            <td style="float:right"><div class="glyphicon glyphicon-info-sign" ng-click="info(layer)">&nbsp;</div></td>
                            <td style="width:10px;"
                                class="{{ layer.dist <= 0.1 ? 'bk-green' : (layer.dist <= 0.3 ? 'bk-yellow' : (layer.dist <= 1 ? 'bk-red' : 'bk-white'))}}">
                                &nbsp
                            </td>
                        </tr>
                        </tbody>
                    </table>

                    <div style="float:left">
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-default" ng-click="clearSelection()">Clear selection</button>
                        </div>
                        <a style="padding-left:20px;" download="layerList.txt" ng-href="{{exportUrl}}" ng-disabled="{{exportUrl == null}}">
                            <i class="glyphicon glyphicon-download-alt"></i>Export
                        </a>
                        <label style="padding-left:20px;"
                               class="{{validLayerSelection ? '' : 'red-text' }}">{{_selection.layers.length}} of {{layers.length}} layers
                            selected</label>
                    </div>
                </div>

                <uib-progressbar ng-show="layers == undefined || layers.length == 0" class="progress-striped"
                    ng-class="{ active: true }" value="100" type='info' title="Updating">loading...</uib-progressbar>

            </div>
        </div>
    </div>
</div>